<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>User Profile</title>
</head>
<body>
<h1>User Profile</h1>
<div id="profile-area">
</div>

<script>
    document.addEventListener("DOMContentLoaded", async () => {
        const accessToken = localStorage.getItem('accessToken');

        if (!accessToken) {
            window.location.href = '/login';
            return;
        }

        try {
            const response = await fetch('/api/users', {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + accessToken
                }
            });

            if (response.ok) {
                const userProfile = await response.json();
                displayUserProfile(userProfile);
            } else {
                handleUnauthorized();
            }
        } catch (error) {
            console.error('Error fetching profile:', error);
            handleUnauthorized();
        }
    });

    function displayUserProfile(userProfile) {
        const profileArea = document.getElementById('profile-area');
        profileArea.innerHTML = `
                <p><strong>ID:</strong> ${userProfile.id}</p>
                <p><strong>Nickname:</strong> ${userProfile.nickname}</p>
                <p><strong>Email:</strong> ${userProfile.email}</p>
                <p><strong>OAuth Provider:</strong> ${userProfile.oauthProvider}</p>
            `;
    }

    function handleUnauthorized() {
        localStorage.removeItem('accessToken');
        localStorage.removeItem('refreshToken');
        window.location.href = '/login';
    }
</script>
</body>
</html>
